"use strict";!function(){function e(){document.body.addEventListener("touchmove",function(e){e.preventDefault()},!1)}var i,t,s,a,n,c=5,r=3,d=6,o=[],v=[];i="n"+d,n={step:"game-select",cardSize:0,lineNum:0,screenType:"",seatList:_.range(1,16),roleList:[{style:{}}]},e(),new Vue({el:"#index",created:function(){switch(this.initDeviceInfo(),n.step){case"game-select":this.initGameRole()}},data:{game:n,viewRandom:0,playerNum:0},methods:{updateView:function(){return this.viewRandom=Math.random()},initDeviceInfo:function(){var e,i;t=$.device.w>$.device.h?$.device.h:$.device.w,s=$.device.w>$.device.h?$.device.w:$.device.h,e=(t-10*(r+1))/r,i=(s-10*(r+1))/c,a=parseInt(e>i?i:e),n.cardSize=a,n.lineNum=$.device.w>$.device.h?c:r,n.screenType=$.device.w>$.device.h?"transverse":"vertical",n.seatDirection=SEAT_DIRECTION[n.screenType]},initGameRole:function(){n.roleList=[],_.map(ALL_ROLE,function(e){for(var i=0;i<e.maxNum;i++)n.roleList.push(_.clone(e))})},initGameSeat:function(){var e=ROLE_SEAT[this.playerNum];e="transverse"===n.screenType?e.t:e.v,n.roleList=[],v=_.shuffle(v);for(var i=0;15>i;i++)e.indexOf(","+(i+1)+",")>-1?n.roleList.push({}):(v[0].sortBy=0,n.roleList.push(v[0]),v=_.rest(v)),this.seatStyle(i+1,n.roleList[i])},seatStyle:function(e,i){var t={};switch(t.width=t.height=n.cardSize+"px",n.screenType){case"transverse":break;case"vertical":(2===e||5===e||8===e||11===e||14===e)&&(t.left="50%",t["margin-left"]="-"+n.cardSize/2+"px"),(7===e||8===e||9===e)&&(t.top="50%",t["margin-top"]="-"+n.cardSize/2+"px"),(4===e||5===e||6===e)&&(t.top=($.device.h/2-2.5*n.cardSize-10)/2+10+n.cardSize+"px"),(10===e||11===e||12===e)&&(t.bottom=($.device.h/2-2.5*n.cardSize-10)/2+10+n.cardSize+"px")}return _.extend(i,{style:t})},clickSelectRole:function(e){e.active=!e.active;var i=_.where(this.game.roleList,{active:!0}).length;this.playerNum=i>5?i-3:0,this.updateView()},clickConfirmRole:function(){_.findWhere(this.game.roleList,{type:"WEREWOLF",active:!0})?this.playerNum>12?alert("最多12个玩家"):"game-select"===n.step?($(".select-card-title").addClass("hide"),$(".select-seat-box").addClass("show"),n.step="game-select-seat"):(v=_.where(this.game.roleList,{active:!0}),n.step="game-distribution",this.initGameSeat()):alert("未选择狼人")},clickConfirmSeat:function(e,i){var t=_.max(this.game.seatList,function(e){return e.num});e.num||(this.game.seatList[i]={num:-1/0!==t?t.num+1:1}),console.log(this.game.seatList),this.updateView()},clickSeeRole:function(e){return"transverse"===n.screenType&&",6,7,8,".indexOf(","+e.index()+",")>-1||"vertical"===n.screenType&&",4,7,10,".indexOf(","+e.index()+",")>-1?!1:(e.removeClass("game-distribution").css({"z-index":1}),void this.updateView())},initGame:function(){var e,d,v=[];t=$.device.w>$.device.h?$.device.h:$.device.w,s=$.device.w>$.device.h?$.device.w:$.device.h,e=(t-10*(r+1))/r,d=(s-10*(r+1))/c,a=parseInt(e>d?d:e),$(".card-item").width(a).height(a),_.map(ALL_ROLE,function(e){if(!_.isEmpty(e.assignment)&&e.assignment[i])for(var t=0;t<e.assignment[i];t++)o.push(e)}),o=_.shuffle(o);for(var h=1;c*r>=h;h++){var l=$.device.w>$.device.h?ROLE_SEAT[i].w:ROLE_SEAT[i].h;l.indexOf(","+h+",")>-1?v.push({}):(v.push(o[0]),o=_.rest(o))}o=v,n.step="game-distribution",n.roleList=o,n.cardSize=a,n.lineNum=$.device.w>$.device.h?c:r,n.screenType=$.device.w>$.device.h?"transverse":"vertical"}}})}();