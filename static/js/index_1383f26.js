"use strict";!function(){function e(){document.body.addEventListener("touchmove",function(e){e.preventDefault()},!1)}var i,t,a,r,n=5,s=3,c=6,d=[],v=[],o={};i="n"+c,o.step=o.step||"game-select",e(),new Vue({el:"#index",created:function(){switch(this.initDeviceInfo(),o.step){case"game-select":this.initGameRole()}},data:{game:o,viewRandom:0,playerNum:0},methods:{updateView:function(){return this.viewRandom=Math.random()},clickCard:function(e,i){var t=$(e.currentTarget);switch(o.step){case"game-select":var a=0;i.active=!i.active,a=_.where(this.game.roleList,{active:!0}).length,this.playerNum=a>5?a-3:0;break;case"game-distribution":this.gameDistribution(t)}this.updateView()},initDeviceInfo:function(){var e,i;t=$.device.w>$.device.h?$.device.h:$.device.w,a=$.device.w>$.device.h?$.device.w:$.device.h,e=(t-10*(s+1))/s,i=(a-10*(s+1))/n,r=parseInt(e>i?i:e),o.cardSize=r,o.lineNum=$.device.w>$.device.h?n:s,o.screenType=$.device.w>$.device.h?"transverse":"vertical"},initGameRole:function(){o.roleList=[],_.map(ALL_ROLE,function(e){for(var i=0;i<e.maxNum;i++)o.roleList.push(_.clone(e))})},initGameSeat:function(){var e=ROLE_SEAT[this.playerNum];e="transverse"===o.screenType?e.t:e.v,o.roleList=[],v=_.shuffle(v);for(var i=0;15>i;i++)e.indexOf(","+(i+1)+",")>-1?o.roleList.push({}):(v[0].sortBy=0,o.roleList.push(v[0]),v=_.rest(v)),this.seatStyle(i+1,o.roleList[i])},seatStyle:function(e,i){var t={};switch(t.width=t.height=o.cardSize+"px",o.screenType){case"transverse":break;case"vertical":(2===e||5===e||8===e||11===e||14===e)&&(t.left="50%",t["margin-left"]="-"+o.cardSize/2+"px"),(7===e||8===e||9===e)&&(t.top="50%",t["margin-top"]="-"+o.cardSize/2+"px"),(4===e||5===e||6===e)&&(t.top=($.device.h/2-2.5*o.cardSize-10)/2+10+o.cardSize+"px"),(10===e||11===e||12===e)&&(t.bottom=($.device.h/2-2.5*o.cardSize-10)/2+10+o.cardSize+"px")}return _.extend(i,{style:t})},clickStartGame:function(){_.findWhere(this.game.roleList,{type:"WEREWOLF",active:!0})?this.playerNum>12?alert("最多12个玩家"):(v=_.where(this.game.roleList,{active:!0}),o.step="game-distribution",this.initGameSeat()):alert("未选择狼人")},gameDistribution:function(e){return"transverse"===o.screenType&&",6,7,8,".indexOf(","+e.index()+",")>-1||"vertical"===o.screenType&&",4,7,10,".indexOf(","+e.index()+",")>-1?!1:void e.removeClass("game-distribution").css({"z-index":1})},initGame:function(){var e,c,v=[];t=$.device.w>$.device.h?$.device.h:$.device.w,a=$.device.w>$.device.h?$.device.w:$.device.h,e=(t-10*(s+1))/s,c=(a-10*(s+1))/n,r=parseInt(e>c?c:e),$(".card-item").width(r).height(r),_.map(ALL_ROLE,function(e){if(!_.isEmpty(e.assignment)&&e.assignment[i])for(var t=0;t<e.assignment[i];t++)d.push(e)}),d=_.shuffle(d);for(var h=1;n*s>=h;h++){var u=$.device.w>$.device.h?ROLE_SEAT[i].w:ROLE_SEAT[i].h;u.indexOf(","+h+",")>-1?v.push({}):(v.push(d[0]),d=_.rest(d))}d=v,o.step="game-distribution",o.roleList=d,o.cardSize=r,o.lineNum=$.device.w>$.device.h?n:s,o.screenType=$.device.w>$.device.h?"transverse":"vertical"}}})}();