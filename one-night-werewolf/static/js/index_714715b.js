"use strict";!function(){function e(){document.body.addEventListener("touchmove",function(e){e.preventDefault()},!1)}var i,t,s,a,c,n,r=5,d=3,o=6,h=[],v=[];i="n"+o,c={step:"game-select",cardSize:0,lineNum:0,screenType:"",seatList:_.range(1,16),roleList:[{style:{}}]},e(),new Vue({el:"#index",created:function(){switch(this.initDeviceInfo(),c.step){case"game-select":this.initGameRole()}},data:{game:c,viewRandom:0,playerNum:0},methods:{updateView:function(){return this.viewRandom=Math.random()},initDeviceInfo:function(){var e,i;t=$.device.w>$.device.h?$.device.h:$.device.w,s=$.device.w>$.device.h?$.device.w:$.device.h,e=(t-10*(d+1))/d,i=(s-10*(d+1))/r,a=parseInt(e>i?i:e),c.cardSize=a,c.lineNum=$.device.w>$.device.h?r:d,c.screenType=$.device.w>$.device.h?"transverse":"vertical",c.seatDirection=SEAT_DIRECTION[c.screenType],n=HOLE_CARDS[c.screenType]},initGameRole:function(){c.roleList=[],_.map(ALL_ROLE,function(e){for(var i=0;i<e.maxNum;i++)c.roleList.push(_.clone(e))})},initGameSeat:function(){c.roleList=[],v=_.shuffle(v);for(var e=0;15>e;e++)_.isObject(this.game.seatList[e])?(v[0].sortBy=this.game.seatList[e].num,c.roleList.push(v[0]),v=_.rest(v)):c.roleList.push({}),this.seatStyle(e+1,c.roleList[e])},seatStyle:function(e,i){var t={};switch(t.width=t.height=c.cardSize+"px",c.screenType){case"transverse":break;case"vertical":(2===e||5===e||8===e||11===e||14===e)&&(t.left="50%",t["margin-left"]="-"+c.cardSize/2+"px"),(7===e||8===e||9===e)&&(t.top="50%",t["margin-top"]="-"+c.cardSize/2+"px"),(4===e||5===e||6===e)&&(t.top=($.device.h/2-2.5*c.cardSize-10)/2+10+c.cardSize+"px"),(10===e||11===e||12===e)&&(t.bottom=($.device.h/2-2.5*c.cardSize-10)/2+10+c.cardSize+"px")}return _.extend(i,{style:t})},clickSelectRole:function(e){e.active=!e.active;var i=_.where(this.game.roleList,{active:!0}).length;this.playerNum=i>5?i-3:0,this.updateView()},clickConfirmRole:function(){_.findWhere(this.game.roleList,{type:"WEREWOLF",active:!0})?this.playerNum>12?alert("最多12个玩家"):"game-select"===c.step?($(".select-card-title").addClass("hide"),$(".select-seat-box").addClass("show"),c.step="game-select-seat"):"game-select-seat"===c.step&&(v=_.where(this.game.roleList,{active:!0}),c.step="game-distribution",this.initGameSeat()):alert("未选择狼人")},clickConfirmSeat:function(e,i){if(_.indexOf(n,i+1)>-1)return!1;if(_.isObject(e)&&e.num)return e.num=null,this.updateView(),!1;for(var t=1;t<=this.playerNum;t++)if(_.isEmpty(_.findWhere(this.game.seatList,{num:t})))return this.updateView(),this.game.seatList[i]={num:t}},clickSeeRole:function(e,i){return _.indexOf(n,i+1)>-1?!1:void this.updateView()},initGame:function(){var e,n,o=[];t=$.device.w>$.device.h?$.device.h:$.device.w,s=$.device.w>$.device.h?$.device.w:$.device.h,e=(t-10*(d+1))/d,n=(s-10*(d+1))/r,a=parseInt(e>n?n:e),$(".card-item").width(a).height(a),_.map(ALL_ROLE,function(e){if(!_.isEmpty(e.assignment)&&e.assignment[i])for(var t=0;t<e.assignment[i];t++)h.push(e)}),h=_.shuffle(h);for(var v=1;r*d>=v;v++){var l=$.device.w>$.device.h?ROLE_SEAT[i].w:ROLE_SEAT[i].h;l.indexOf(","+v+",")>-1?o.push({}):(o.push(h[0]),h=_.rest(h))}h=o,c.step="game-distribution",c.roleList=h,c.cardSize=a,c.lineNum=$.device.w>$.device.h?r:d,c.screenType=$.device.w>$.device.h?"transverse":"vertical"}}})}();